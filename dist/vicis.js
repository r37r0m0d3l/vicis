!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t=t||self).vicis={})}(this,(function(t){"use strict";const e=["boolean","flag","numeric","integer","string","json"];function r(t,e){var r=e.get(t);if(!r)throw new TypeError("attempted to get private field on non-instance");return r.get?r.get.call(t):r.value}function n(t,e,r){var n=e.get(t);if(!n)throw new TypeError("attempted to set private field on non-instance");if(n.set)n.set.call(t,r);else{if(!n.writable)throw new TypeError("attempted to set read only private field");n.value=r}return r}function i(t,e){if(!t.length||!e.length)return[];const r=new Set(e);return[...new Set(t)].filter(t=>r.has(t))}function s(t,e){if(!t.length||!e.length)return!1;const r=new Set(e);return Boolean([...new Set(t)].filter(t=>r.has(t)).length)}const o=["cast","defaults","defined","exclude","omit","order","pick","sort","rename","replace","required","transform"];function a(t){return 0===Object.keys(t).length}function c(t){return null!==t&&"object"==typeof t&&!Array.isArray(t)}function u(t){return"string"==typeof t}function h(t){return JSON.stringify(t)}function f(t){if(!c(t))throw new TypeError("Cast should be an object");return a(t)?{}:(Object.keys(t).forEach(r=>{if(!u(t[r]))throw new TypeError(`'Cast' expect object values to be strings. Not a string at key: '${h(t[r])}'.`);if(!e.includes(t[r]))throw new TypeError(`'Cast' has unknown type in {${r}: "${t[r]}"}.`)}),t)}function l(t){if(null==t)return"";if("string"==typeof t)return t;const e=t.toString();return"0"===e&&Object.is(t,-0)?"-0":e}const y="boolean",w="flag",p="numeric",b="integer",d="string",m="json";function g(t){return JSON.parse(t)}function E(t){return"[object Function]"===Object.prototype.toString.call(t)&&!/^class\s/.test(Function.prototype.toString.call(t))}function j(t){return function(t){return u(t)?g(t):t}(function(t){let e;const{toJSON:r,toObject:n}=t;return e=E(n)?t.toObject():E(r)?t.toJSON():t,u(e)?e:h(e)}(t))}function k(t,e){return a(t)||Object.keys(t).forEach(r=>{const n=t[r];if(!(r in e))throw new Error(`Field '${r}' suppose to be converted to ${n}.`);switch(n){case y:e[r]=Boolean(e[r]);break;case w:e[r]=function(t,e=!1,r=!1){if(null==t)return e;if("boolean"==typeof t)return t;const n=t.toString().toLocaleLowerCase().trim();return 0===n.length?e:"true"===n||"1"===n||"false"!==n&&"0"!==n&&r}(e[r]);break;case p:{const t=Number(e[r]);if(Number.isFinite(t))e[r]=t;else{const t=Number.parseFloat(l(e[r]).trim());Number.isFinite(t)?e[r]=t:e[r]=0}break}case b:{const t=Number(e[r]);if(Number.isFinite(t))e[r]=Math.trunc(t);else{const n=Number.parseFloat(l(e[r]).trim());Number.isFinite(n)?e[r]=Math.trunc(t):e[r]=0}break}case d:e[r]=l(e[r]);break;case m:e[r]=j(e[r]);break;default:throw new Error("Unknown value convert error")}}),e}function O(t,e=!1){return e?function t(e,r=!0){if(!e||"object"!=typeof e||Array.isArray(e))return e;const n=Object.keys(e);return n.length?n.reduce((n,i)=>(r&&e[i]&&"object"==typeof e[i]&&!Array.isArray(e[i])?n[i]=t(e[i],r):n[i]=e[i],n),{}):e}(g(h(t)),!0):g(h(t))}function v(t){switch(A(t)){case"array":return t.slice();case"object":return Object.assign({},t);case"date":return new t.constructor(Number(t));case"map":return new Map(t);case"set":return new Set(t);case"buffer":return function(t){const e=t.length;let r;r=Buffer.allocUnsafe?Buffer.allocUnsafe(e):Buffer.from(e);return t.copy(r),r}(t);case"symbol":return function(t){if(Symbol.prototype.valueOf)return Object(Symbol.prototype.valueOf.call(t));return{}}(t);case"arraybuffer":return function(t){const e=new t.constructor(t.byteLength);return new Uint8Array(e).set(new Uint8Array(t)),e}(t);case"float32array":case"float64array":case"int16array":case"int32array":case"int8array":case"uint16array":case"uint32array":case"uint8clampedarray":case"uint8array":return function(t){return new t.constructor(t.buffer,t.byteOffset,t.length)}(t);case"regexp":return function(t){let e;e=void 0!==t.flags?t.flags:/\w+$/.exec(t)||void 0;const r=new t.constructor(t.source,e);return r.lastIndex=t.lastIndex,r}(t);case"error":return Object.create(t);default:return t}}function A(t){if(void 0===t)return"undefined";if(null===t)return"null";if(!0===t||!1===t||t instanceof Boolean)return"boolean";if("string"==typeof t||t instanceof String)return"string";if("number"==typeof t||t instanceof Number)return"number";if("function"==typeof t||t instanceof Function)return"function";if(void 0!==Array.isArray&&Array.isArray(t))return"array";if(t instanceof RegExp)return"regexp";if(t instanceof Date)return"date";var e,r=toString.call(t);return"[object RegExp]"===r?"regexp":"[object Date]"===r?"date":"[object Arguments]"===r?"arguments":"[object Error]"===r?"error":null!==(e=t)&&Boolean(e.constructor)&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)?"buffer":"[object Set]"===r?"set":"[object WeakSet]"===r?"weakset":"[object Map]"===r?"map":"[object WeakMap]"===r?"weakmap":"[object Symbol]"===r?"symbol":"[object Int8Array]"===r?"int8array":"[object Uint8Array]"===r?"uint8array":"[object Uint8ClampedArray]"===r?"uint8clampedarray":"[object Int16Array]"===r?"int16array":"[object Uint16Array]"===r?"uint16array":"[object Int32Array]"===r?"int32array":"[object Uint32Array]"===r?"uint32array":"[object Float32Array]"===r?"float32array":"[object Float64Array]"===r?"float64array":"object"}function T(t){return!0===function(t){return"object"==typeof t&&null!==t}(t)&&"[object Object]"===Object.prototype.toString.call(t)}function S(t,e){switch(A(t)){case"object":return function(t,e){if("function"==typeof e)return e(t);if(e||function(t){let e,r;return!1!==T(t)&&(e=t.constructor,"function"==typeof e&&(r=e.prototype,!1!==T(r)&&!1!==r.hasOwnProperty("isPrototypeOf")))}(t)){const r=new t.constructor;for(let n in t)r[n]=S(t[n],e);return r}return t}(t,e);case"array":return function(t,e){const r=new t.constructor(t.length);for(let n=0;n<t.length;n++)r[n]=S(t[n],e);return r}(t,e);default:return v(t)}}function N(t){return function(t){return Object(t)!==t}(t)?t:S(t)}function $(t){if(!c(t))throw new TypeError("'Defaults' should be an object");return t}function x(t,e){return a(t)||Object.keys(t).forEach(r=>{r in e&&void 0!==e[r]||(e[r]=t[r])}),e}function M(t,e=!0){if(t.length<2)return t;let r=[...new Set(t)];if(r.includes(0)){const e=t.filter(t=>0===t);e.length>1&&e.some(t=>1/t===Number.NEGATIVE_INFINITY)&&r.push(-0)}if(r.filter(t=>"string"==typeof t).length){const e=t.filter(t=>"string"==typeof t);if(e.length>1){const t=[...new Set(e.map(t=>t.normalize()))];t.forEach(t=>{delete r[r.indexOf(t)]});const n=[];for(let t=0;t<r.length;t++)t in r&&n.push(r[t]);r=n.concat(t)}}return e?r.sort():r}function F(t){return 0===t.length}function W(t){if(!Array.isArray(t))throw new TypeError("'Defined' should be an array");return F(t)?[]:M(t).map(t=>{if(!u(t))throw new TypeError(`'Defined' expect array of strings. Value: '${h(t)}'.`);return t})}function C(t,e){const r=W(t);return F(r)||r.forEach(t=>{if(!(t in e))throw new Error(`Field '${t}' must be defined.`);if(void 0===e[t])throw new Error(`Field '${t}' should have value.`)}),e}function I(t){return t instanceof RegExp}function R(t){if(!Array.isArray(t))throw new TypeError("'Exclude' should be an array");return F(t)?[]:M(t).map(t=>{if(!u(t)&&!I(t))throw new TypeError(`'Exclude' expect array of strings or regular expressions. Value: '${h(t)}'.`);return t})}function J(t){return Object.keys(t).sort((t,e)=>t.localeCompare(e))}function U(t){if(!Array.isArray(t))throw new TypeError("'Omit' should be an array");return F(t)?[]:M(t).map(t=>{if(!u(t))throw new TypeError(`'Omit' expect array of strings. Value: '${h(t)}'.`);return t})}function q(t){if(!Array.isArray(t))throw new TypeError("'Order' should be an array");return F(t)?[]:M(t,!1).map(t=>{if(!u(t))throw new TypeError(`'Order' expect array of strings. Value: '${h(t)}'.`);return t})}function B(t,e=[],r=!1){if(!Array.isArray(e)||0===e.length)return t;const n=e.filter(t=>"string"==typeof t);let i=new Set(Object.keys(t));const s={};return n.forEach(e=>{i.delete(e),e in t&&(s[e]=t[e])}),i=[...i],r&&(i=i.sort((t,e)=>t.localeCompare(e))),i.forEach(e=>s[e]=t[e]),s}function D(t){if(!Array.isArray(t))throw new TypeError("'Pick' should be an array");return F(t)?[]:M(t).map(t=>{if(!u(t))throw new TypeError(`'Pick' expect array of strings. Value: '${h(t)}'.`);return t})}function V(t,e){if(F(t))return e;const r={};return Object.keys(e).forEach(n=>{t.includes(n)&&(r[n]=e[n])}),r}function P(t){if(!c(t))throw new TypeError("'Rename' should be an object");if(a(t))return{};Object.keys(t).forEach(t=>{if(!u(t))throw new TypeError(`'Rename' expect object values to be strings. Not a string at key: '${t}'.`)});const e=Object.values(t),r=M(e);if(e.length!==r.length)throw new TypeError(`'Rename' has similar values: '${h(r)}'.`);return t}function L(t,e){if(a(t))return e;const r=Object.keys(t).sort((t,e)=>t.localeCompare(e)),n={};return r.forEach(r=>{if(!(r in e))throw new Error(`Field '${r}' suppose to be renamed.`);n[t[r]]=e[r]}),r.forEach(t=>{delete e[t]}),Object.assign(e,n),e}function G(t){if(!c(t))throw new TypeError("'Replace' should be an object");return t}function _(t,e){return a(t)||Object.keys(t).forEach(r=>{e[r]=t[r]}),e}function Y(t){if(!Array.isArray(t))throw new TypeError("'Required' should be an array");return F(t)?[]:M(t).map(t=>{if(!u(t))throw new TypeError(`'Required' expect array of strings. Value: '${h(t)}'.`);return t})}function z(t,e){return F(t)||t.forEach(t=>{if(!(t in e))throw new Error(`Field '${t}' is required.`)}),e}function H(t){if(!c(t))throw new TypeError("'Transform' should be an object");return a(t)?{}:(Object.keys(t).forEach(e=>{if(!(r=t[e])||!(E(r)||"toFunction"in r&&E(r.toFunction)&&E(r.toFunction())))throw new TypeError(`'Transform' expect object values to be functions. Not a function at key: '${e}'.`);var r}),t)}function K(t,e){return a(t)||Object.keys(t).forEach(r=>{if(!(r in e))throw new Error(`Field '${r}' suppose to be transformed.`);E(t[r])?e[r]=t[r](e[r],r,N(e)):e[r]=t[r].toFunction()(e[r],r,N(e))}),e}class Q{constructor(t={},e){X.set(this,{writable:!0,value:{}}),Z.set(this,{writable:!0,value:[]}),tt.set(this,{writable:!0,value:[]}),et.set(this,{writable:!0,value:[]}),rt.set(this,{writable:!0,value:[]}),nt.set(this,{writable:!0,value:[]}),it.set(this,{writable:!0,value:[]}),st.set(this,{writable:!0,value:!1}),ot.set(this,{writable:!0,value:{}}),at.set(this,{writable:!0,value:{}}),ct.set(this,{writable:!0,value:[]}),ut.set(this,{writable:!0,value:{}}),ht.set(this,{writable:!0,value:{}}),ft.set(this,{writable:!0,value:void 0}),lt.set(this,{writable:!0,value:void 0}),yt.set(this,{writable:!0,value:void 0}),n(this,lt,function(){const t=J(r(this,X)),e=J(r(this,ot)),n=J(r(this,at)),o=J(r(this,ut));if(s(r(this,rt),t))throw new Error(`'omit' has same keys as 'cast': ${i(r(this,rt),t)}.`);if(s(r(this,rt),r(this,tt)))throw new Error(`'omit' has same keys as 'defined': ${i(r(this,rt),r(this,tt))}.`);if(s(r(this,rt),r(this,it)))throw new Error(`'omit' has same keys as 'pick': ${i(r(this,rt),r(this,it))}.`);if(s(r(this,rt),e))throw new Error(`'omit' has same keys as 'rename': ${i(r(this,rt),e)}.`);if(s(r(this,rt),n))throw new Error(`'omit' has same keys as 'replace': ${i(r(this,rt),n)}.`);if(s(r(this,rt),r(this,ct)))throw new Error(`'omit' has same keys as 'required': ${i(r(this,rt),r(this,ct))}.`);if(s(r(this,rt),o))throw new Error(`'omit' has same keys as 'transform': ${i(r(this,rt),o)}.`);if(s(r(this,rt),o))throw new Error(`'omit' has same keys as 'transform': ${i(r(this,rt),o)}.`);if(s(t,n))throw new Error(`'cast' has same keys as 'replace': ${i(t,n)}.`);if(s(t,o))throw new Error(`'cast' has same keys as 'transform': ${i(t,o)}.`);if(s(n,o))throw new Error(`'replace' has same keys as 'transform': ${i(n,o)}.`);return this}.bind(this)),n(this,yt,function(){return void 0===r(this,ft)||("toObject"in r(this,ft)&&E(r(this,ft).toObject)?n(this,ht,r(this,ft).toObject()):"toJSON"in r(this,ft)&&E(r(this,ft).toJSON)?n(this,ht,r(this,ft).toJSON()):n(this,ht,r(this,ft)),n(this,ht,function(t,e){if(F(t))return e;const r={};return Object.keys(e).forEach(n=>{t.includes(n)||(r[n]=e[n])}),r}(r(this,rt),r(this,ht))),n(this,ht,z(r(this,ct),r(this,ht))),n(this,ht,C(r(this,tt),r(this,ht))),n(this,ht,k(r(this,X),r(this,ht))),n(this,ht,K(r(this,ut),r(this,ht))),n(this,ht,_(r(this,at),r(this,ht))),n(this,ht,L(r(this,ot),r(this,ht))),n(this,ht,x(r(this,Z),r(this,ht))),n(this,ht,V(r(this,it),r(this,ht))),n(this,ht,function(t,e){if(F(t))return e;const r=t.filter(u);if(r.length&&Object.keys(e).forEach(t=>{r.includes(t)&&delete e[t]}),0===J(e).length)return e;const n=t.filter(I);return n.length&&n.forEach(t=>{Object.keys(e).forEach(r=>{t.test(r)&&delete e[r]})}),e}(r(this,et),r(this,ht))),n(this,ht,O(r(this,ht),r(this,st))),n(this,ht,function(t,e,r=!1){return F(t)?e:B(e,t,r)}(r(this,nt),r(this,ht),r(this,st)))),this}.bind(this)),this.config(t),void 0!==e&&this.data(e)}static factory(t={},e){return new Q(t,e)}static get BOOLEAN(){return"boolean"}static get FLAG(){return"flag"}static get NUMERIC(){return"numeric"}static get INTEGER(){return"integer"}static get STRING(){return"string"}static get JSON(){return"json"}getConfig(){return N({cast:r(this,X),defaults:r(this,Z),defined:r(this,tt),exclude:r(this,et),omit:r(this,rt),order:r(this,nt),pick:r(this,it),sort:r(this,st),rename:r(this,ot),replace:r(this,at),required:r(this,ct),transform:r(this,ut)})}resetConfig(){return n(this,X,{}),n(this,Z,{}),n(this,tt,[]),n(this,et,[]),n(this,rt,[]),n(this,nt,[]),n(this,it,[]),n(this,st,!1),n(this,ot,{}),n(this,at,{}),n(this,ct,[]),n(this,ut,{}),this}config(t={}){if(!c(t))throw new TypeError("Config should be an object");const e=function(t,e){const r=new Set(e);return t.filter(t=>!r.has(t))}(J(t),o);if(e.length)throw new TypeError(`Config has unknown fields: '${e.join("', '")}'.`);return this.resetConfig(),this.sort(t.sort),this.omit(t.omit),this.cast(t.cast),this.defined(t.defined),this.pick(t.pick),this.rename(t.rename),this.replace(t.replace),this.required(t.required),this.transform(t.transform),this.defaults(t.defaults),this.exclude(t.exclude),this.order(t.order),r(this,lt).call(this),r(this,yt).call(this),this}cast(t={}){return n(this,X,f(t)),r(this,lt).call(this),r(this,yt).call(this),this}defaults(t={}){return n(this,Z,$(t)),r(this,lt).call(this),r(this,yt).call(this),this}defined(t=[]){return n(this,tt,W(t)),r(this,lt).call(this),r(this,yt).call(this),this}exclude(t=[]){return n(this,et,R(t)),r(this,lt).call(this),r(this,yt).call(this),this}omit(t=[]){return n(this,rt,U(t)),r(this,lt).call(this),r(this,yt).call(this),this}order(t=[]){return n(this,nt,q(t)),r(this,lt).call(this),r(this,yt).call(this),this}pick(t=[]){return n(this,it,D(t)),r(this,lt).call(this),r(this,yt).call(this),this}rename(t={}){return n(this,ot,P(t)),r(this,lt).call(this),r(this,yt).call(this),this}replace(t={}){return n(this,at,G(t)),r(this,lt).call(this),r(this,yt).call(this),this}required(t=[]){return n(this,ct,Y(t)),r(this,lt).call(this),r(this,yt).call(this),this}sort(t=!1){if("boolean"!=typeof t)throw new TypeError("'sort' should be a boolean");return n(this,st,t),r(this,yt).call(this),this}transform(t={}){return n(this,ut,H(t)),r(this,lt).call(this),r(this,yt).call(this),this}getData(){return N(r(this,ht))}data(t){if(!c(t))throw new TypeError("Data should be an object");return n(this,ft,t),r(this,yt).call(this),this}clear(){return n(this,ht,{}),n(this,ft,void 0),this}toJSON(){return this.getData()}toString(){return h(this.toJSON())}fromArray(t){return Array.from(t).map(t=>this.data(t).toJSON())}}var X=new WeakMap,Z=new WeakMap,tt=new WeakMap,et=new WeakMap,rt=new WeakMap,nt=new WeakMap,it=new WeakMap,st=new WeakMap,ot=new WeakMap,at=new WeakMap,ct=new WeakMap,ut=new WeakMap,ht=new WeakMap,ft=new WeakMap,lt=new WeakMap,yt=new WeakMap;t.TYPES_ENUM=e,t.Vicis=Q,t.cast=function(t,e={}){const r=f(e);return a(r)?t:k(r,t)},t.defaults=function(t,e={}){return a($(e))?t:x(e,t)},t.defined=function(t,e=[]){return F(e)?t:C(e,t)},t.exclude=function(t,e=[]){const r=R(e);if(F(r))return t;const n=r.filter(u);if(n.length&&Object.keys(t).forEach(e=>{n.includes(e)&&delete t[e]}),0===J(t).length)return t;const i=r.filter(I);return i.length&&i.forEach(e=>{Object.keys(t).forEach(r=>{e.test(r)&&delete t[r]})}),t},t.omit=function(t,e=[]){const r=U(e);if(F(r))return t;const n={};return Object.keys(t).forEach(e=>{r.includes(e)||(n[e]=t[e])}),n},t.order=function(t,e=[],r=!1){return F(q(e))?t:B(t,e,r)},t.pick=function(t,e=[]){const r=D(e);return F(r)?t:V(r,t)},t.rename=function(t,e={}){const r=P(e);return a(r)?t:L(r,t)},t.replace=function(t,e={}){const r=G(e);return a(r)?t:_(r,t)},t.required=function(t,e=[]){const r=Y(e);return F(r)?t:z(r,t)},t.transform=function(t,e={}){const r=H(e);return a(r)?t:K(r,t)},Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=vicis.js.map
